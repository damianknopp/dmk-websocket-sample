// Generated by CoffeeScript 1.6.1
(function() {
  var WebsocketHelper;

  WebsocketHelper = (function() {
    var connect;

    function WebsocketHelper(location) {
      this.location = location != null ? location : "ws://localhost:8080/dmk-websocket/echo";
      this.ws = void 0;
    }

    connect = function(location) {
      var target, ws;
      this.location = location;
      target = this.location;
      ws = new WebSocket(target);
      console.log(ws);
      ws.onmessage = function(event) {
        var json;
        console.log("Received:" + event.data);
        json = JSON.parse(event.data);
        return console.log("parsed = " + json.m1);
      };
      ws.onopen = function() {
        console.log("opened connection");
        return ws.send("syn connection");
      };
      ws.onclose = function() {
        return console.log("closed connection");
      };
      return ws;
    };

    WebsocketHelper.prototype.send = function(obj) {
      var tmp;
      this.obj = obj;
      if (this.ws == null) {
        console.log("websocket is not initialized...");
        this.ws = connect(this.location);
        return console.log(this.ws);
      } else {
        console.log("reusing websocket connection");
        tmp = JSON.stringify(this.obj);
        return this.ws.send(this.obj);
      }
    };

    WebsocketHelper.prototype.close = function() {
      if (this.ws != null) {
        return this.ws.close() && (this.ws = void 0);
      }
    };

    return WebsocketHelper;

  })();

}).call(this);
